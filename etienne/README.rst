Simplified version of the code